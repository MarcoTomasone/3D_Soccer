<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="src2/lib/myStyle.css"></link>
  <link href="https://fonts.cdnfonts.com/css/press-start-2p" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=VT323' rel='stylesheet'>
  <!--<style> @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap'); </style>-->
  <title>3D SOCCER</title>
</head>

<body>
	<h2>Soccer 3D</h2>
	<div class="container">
		<canvas id="upperCanvas" width="1280" height="720" style ="z-index: 10"></canvas>
		<canvas id="screenCanvas" width="1280" height="720"  style="background-color: #e6ffff "></canvas>
		<div id="joystick-div"></div>
	</div>
	<div class="child" id="uiContainer">
		<form>
			<h2> Command Panel</h2>
			<h5> Camera </h5>
			<div>
				<input type = "radio" id="fixedCamera" name="camera" value="fixedCamera" checked>
				<label for="camera1">Fixed Camera on [0,0,0]</label>
				<input type = "radio" id="cameraOnBall" name="camera" value="cameraOnBall">
				<label for="camera1">Camera on Ball</label>
			</div>
			<div>
			<Wdiv>
				<input type="range" id="zoomCamera" name="zoomCamera" min="5" max="100" value="70">
				<label for="zoomCameraLabel">Fov Camera</label>
				<button id="defaultFovButton" name="defaultFov" type="button">Set Default Fov</button>
			</Wdiv>
			<div>
				<button id="defaultAngleButton" name="defaultAngle" type="button">Set Default Camera Angle</button>
				<button id="upCamera" name="upCamera" type="button" disabled>Up Camera</button>
				<button id="rearCamera" name="rearCamera" type="button" disabled>Rear Camera</button>
			</div>
			<h5> Light </h5>
			<input type="range" id="xLight" name="xLight" min="0" max="450" value="0">
			<label for="xLight">Light X direction</label><br>
			<input type="range" id="yLight" name="yLight" min="0" max="450" value="100">
			<label for="yLight">Light Y direction</label><br>
			<input type="range" id="zLight" name="zLight" min="0" max="450" value="350">
			<label for="zLight">Light Z direction</label><br>
			<button id="defaultLightButton" name="defaultLight" type="button">Set Default Light</button>
			<h5> Transparency </h5> 
			<label class="switch">
				<input type="checkbox" id="transparencyCheckbox" checked>
				<span class="slider"></span>
			  </label> 
		</form>

		<p id="cardNumParagraph">Text to be overwritten</p>
	</div>
	
</body>

<script>
	var toStop = false;
	const vs = `
	attribute vec4 a_position;
	attribute vec2 a_texcoord;
	attribute vec3 a_normal;
	attribute vec3 a_tangent;
	attribute vec4 a_color;
  
	uniform mat4 u_projection;
	uniform mat4 u_view;
	uniform mat4 u_world;
	uniform mat4 u_textureMatrix;
	uniform vec3 u_lightPosition;
	uniform vec3 u_viewWorldPosition;
	uniform vec3 u_lightWorldPosition;
  
	varying vec2 v_texcoord;
	varying vec4 v_projectedTexcoord;
	varying vec3 v_normal;
	varying vec3 v_tangent;
	varying vec3 v_surfaceToView;
	varying vec3 v_surfaceToLight;
	varying vec4 v_color;
  
	void main() {

	  vec4 worldPosition = u_world * a_position;
	  gl_Position = u_projection * u_view * worldPosition;
	  v_texcoord = a_texcoord;
	  v_projectedTexcoord = u_textureMatrix * worldPosition;
	  v_normal = mat3(u_world) * a_normal;
	  v_surfaceToView = u_viewWorldPosition - worldPosition.xyz;
	  // compute the world position of the surface
	  vec3 surfaceWorldPosition = (u_world * a_position).xyz;
	  v_surfaceToLight = u_lightPosition - surfaceWorldPosition;
	  mat3 normalMat = mat3(u_world);
	  v_tangent = normalize(normalMat * a_tangent);
	  v_color = a_color;
	}
	`;

	const fs = `
	precision highp float;

	varying vec2 v_texcoord;
	varying vec3 v_normal;
	varying vec3 v_tangent;
	varying vec3 v_surfaceToView;
	varying vec4 v_color;
	varying vec3 v_surfaceToLight;
	varying vec4 v_projectedTexcoord;
	
	uniform vec3 diffuse;
	uniform vec3 ambient;
	uniform vec3 emissive;
	uniform vec3 specular;
	uniform vec3 u_lightDirection;
	uniform vec3 u_ambientLight;
	uniform vec3 u_reverseLightDirection;
	uniform vec4 u_colorMult;

	uniform sampler2D u_texture;
	uniform sampler2D u_projectedTexture;
	uniform sampler2D diffuseMap;
	uniform sampler2D specularMap;
	uniform sampler2D normalMap;

	uniform float opacity;
	uniform float shininess;
	uniform float u_bias;
	uniform float u_lightIntensity;
	uniform float u_shadowIntensity;
  
	void main () {
	  vec3 normal = normalize(v_normal);
	  vec3 tangent = normalize(v_tangent) * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	  vec3 bitangent = normalize(cross(normal, tangent));
  
	  mat3 tbn = mat3(tangent, bitangent, normal);
	  normal = texture2D(normalMap, v_texcoord).rgb * 2. - 1.;
	  normal = normalize(tbn * normal);
  
	  vec3 surfaceToViewDirection = normalize(v_surfaceToView);
	  vec3 halfVector = normalize(u_lightDirection + surfaceToViewDirection);
      vec3 surfaceToLightDirection = normalize(v_surfaceToLight);
	  float light = dot(v_normal, u_reverseLightDirection);
	  vec3 projectedTexcoord = v_projectedTexcoord.xyz / v_projectedTexcoord.w;
	  float currentDepth = projectedTexcoord.z + u_bias;
	  //float fakeLight = dot(u_lightDirection, normal) * .5 + .5;
	  float specularLight = clamp(dot(normal, halfVector), 0.0, 1.0);
	  vec4 specularMapColor = texture2D(specularMap, v_texcoord);
	  vec3 effectiveSpecular = specular * specularMapColor.rgb;
  
	  vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);
	  vec3 effectiveDiffuse = diffuse * diffuseMapColor.rgb * v_color.rgb;
	  float effectiveOpacity = opacity * diffuseMapColor.a * v_color.a;

	  float projectedDepth = texture2D(u_projectedTexture, projectedTexcoord.xy).r;
	  vec4 texColor = texture2D(u_texture, v_texcoord) * u_colorMult;

	  gl_FragColor = vec4(
		  emissive +
		  ambient * u_ambientLight +
		  effectiveDiffuse * light +
		  effectiveSpecular * pow(specularLight, shininess),
		  effectiveOpacity);
	}
	`;
</script>

<script src="./src2/lib/profLibs/m4.js"></script>
<script src="./src2/lib/profLibs/webgl-utils.js"></script>
<script src="./src2/lib/JoyStick.js"></script>
<script type="module" src="./src2/3D_Soccer.js"></script>
</html>